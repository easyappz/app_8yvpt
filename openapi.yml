openapi: 3.0.3
info:
  title: Easyapp Classifieds API
  version: "1.0.0"
  description: OpenAPI specification for the classifieds board (members, auth, listings, metadata).
servers:
  - url: /
security:
  - bearerAuth: []
paths:
  /api/auth/register/:
    post:
      tags: [auth]
      summary: Register a new member
      description: Create a new member account.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MemberRegister'
      responses:
        '201':
          description: Member created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MemberPublic'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/auth/login/:
    post:
      tags: [auth]
      summary: Log in and get JWT token
      description: Authenticate a member and obtain an access token.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MemberLoginRequest'
      responses:
        '200':
          description: Authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/profile/:
    get:
      tags: [profile]
      summary: Get current member profile
      responses:
        '200':
          description: Current member profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MemberPublic'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      tags: [profile]
      summary: Update current member profile (replace)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: Profile update payload (username not editable; password optional)
              properties:
                email:
                  type: string
                  nullable: true
                phone:
                  type: string
                  nullable: true
                password:
                  type: string
              additionalProperties: false
      responses:
        '200':
          description: Updated member profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MemberPublic'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      tags: [profile]
      summary: Partially update current member profile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: Partial profile update (username not editable; password optional)
              properties:
                email:
                  type: string
                  nullable: true
                phone:
                  type: string
                  nullable: true
                password:
                  type: string
              additionalProperties: false
      responses:
        '200':
          description: Updated member profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MemberPublic'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/listings/:
    get:
      tags: [listings]
      summary: List listings
      description: List active listings with optional filters and ordering.
      parameters:
        - in: query
          name: category
          schema:
            type: string
            enum: [cars, realty]
        - in: query
          name: condition
          schema:
            type: string
            enum: [new, used]
        - in: query
          name: min_price
          schema:
            type: number
        - in: query
          name: max_price
          schema:
            type: number
        - in: query
          name: date_from
          schema:
            type: string
            format: date
        - in: query
          name: date_to
          schema:
            type: string
            format: date
        - in: query
          name: q
          schema:
            type: string
        - in: query
          name: ordering
          schema:
            type: string
            enum: ["-created_at", "created_at"]
      responses:
        '200':
          description: Paginated listings
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                  next:
                    type: string
                    format: uri
                    nullable: true
                  previous:
                    type: string
                    format: uri
                    nullable: true
                  results:
                    type: array
                    items:
                      $ref: '#/components/schemas/Listing'
                required: [count, next, previous, results]
    post:
      tags: [listings]
      summary: Create a new listing
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListingCreateUpdate'
      responses:
        '201':
          description: Created listing
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Listing'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/listings/{id}/:
    get:
      tags: [listings]
      summary: Retrieve a listing
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Listing
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Listing'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      tags: [listings]
      summary: Update a listing (replace)
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListingCreateUpdate'
      responses:
        '200':
          description: Updated listing
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Listing'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      tags: [listings]
      summary: Partially update a listing
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListingCreateUpdate'
      responses:
        '200':
          description: Updated listing
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Listing'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      tags: [listings]
      summary: Delete a listing
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Deleted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/meta/categories/:
    get:
      tags: [meta]
      summary: Get available categories
      responses:
        '200':
          description: Categories list
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    key:
                      type: string
                      enum: [cars, realty]
                    label:
                      type: string
                  required: [key, label]
  /api/meta/conditions/:
    get:
      tags: [meta]
      summary: Get available conditions
      responses:
        '200':
          description: Conditions list
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    key:
                      type: string
                      enum: [new, used]
                    label:
                      type: string
                  required: [key, label]
components:
  schemas:
    MemberPublic:
      type: object
      properties:
        id:
          type: integer
          readOnly: true
        username:
          type: string
        email:
          type: string
          nullable: true
        phone:
          type: string
          nullable: true
        date_joined:
          type: string
          format: date-time
          readOnly: true
      required: [id, username, date_joined]
    MemberRegister:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
        email:
          type: string
          nullable: true
        phone:
          type: string
          nullable: true
      required: [username, password]
    MemberLoginRequest:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
      required: [username, password]
    LoginResponse:
      type: object
      properties:
        access:
          type: string
        token_type:
          type: string
          example: bearer
        member:
          $ref: '#/components/schemas/MemberPublic'
      required: [access, token_type, member]
    Listing:
      type: object
      properties:
        id:
          type: integer
          readOnly: true
        title:
          type: string
          maxLength: 255
        description:
          type: string
        price:
          type: number
        category:
          type: string
          enum: [cars, realty]
        condition:
          type: string
          enum: [new, used]
        contact_phone:
          type: string
        contact_email:
          type: string
        author:
          $ref: '#/components/schemas/MemberPublic'
        created_at:
          type: string
          format: date-time
          readOnly: true
        updated_at:
          type: string
          format: date-time
          readOnly: true
        is_active:
          type: boolean
      required:
        - id
        - title
        - description
        - price
        - category
        - condition
        - contact_phone
        - contact_email
        - created_at
        - updated_at
        - is_active
    ListingCreateUpdate:
      type: object
      properties:
        title:
          type: string
          maxLength: 255
        description:
          type: string
        price:
          type: number
        category:
          type: string
          enum: [cars, realty]
        condition:
          type: string
          enum: [new, used]
        contact_phone:
          type: string
        contact_email:
          type: string
      required:
        - title
        - description
        - price
        - category
        - condition
        - contact_phone
        - contact_email
    Error:
      type: object
      properties:
        detail:
          type: string
      required: [detail]
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
